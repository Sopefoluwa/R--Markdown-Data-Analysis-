---
title: "Capstone- Bellabeat Fitness Case Study"
author: "Sopefoluwa Adeleye"
date: "2023-04-03"
output:
  html_document: default
  word_document: default
---
## Summary 
Bellabeat is a high-tech company that manufactures health-focused smart products. They offer beautifully designed wearable technology that collects data on n activity, sleep, stress, and reproductive health which empowers women about their general health and habits 

The main focus of this case study is to analyze smart device usage to gain insights into how people are already using their smart devices in order to determine how it can inform Bellabeats Marketing strategy to unlock new growth opportunities. The Product in focus being the Bellabeat app.

The Bellabeat app provides users with health data related to their activity, sleep, stress,menstrual cycle, and mindfulness habits. This data can help users better understand their current habits and make healthy decisions. The Bellabeat app connects to their line of smart wellness products

## Ask Phase

### Business Task 

Analyze smart device usage data of Non-Bellabeat users and identify trends in order to apply insights gained to Bellabeat's Marketing strategy.

#### Stakeholders

* Urška Sršen - Bellabeat cofounder and Chief Creative Officer
* Sando Mur - Bellabeat cofounder and key member of Bellabeat executive team
* Bellabeat Marketing Analytics team

## Prepare Phase 

### Dataset used: 
The data source of the casestudy is the FitBit Fitness Tracker Data.
This dataset is publicly hosted on the Kaggle platform and was made available through Mobius.

### Accessibility and privacy of data:
Verifying the metadata of the dataset we can confirm it is open-source.
The owner made the data freely accessible to the public by waiving all of his/her rights to the data worldwide under copyright law, including all related and neighboring rights, to the extent allowed by law.
The data can be freely, copied, modified, distributed and analyzed even for commercial purposes, without asking permission. 

### Data Content
The dataset was generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring.

### Data Organization and Verification:
Available to us are 18 CSV documents. Each document represents different quantitative data tracked by Fitbit. The data is considered long since each row is one time point per subject, so each subject will have data in multiple rows.Every user has a unique ID and different rows since data is tracked by day and time.

The 18 Files are:

 * dailyActivity_merged.csv
 * dailyCalories_merged.csv
 * dailyIntensities_merged.csv
 * dailySteps_merged.csv
 * heartrate_seconds_merged.csv
 * hourlyCalories_merged.csv
 * hourlyIntensities_merged.csv
 * hourlySteps_merged.csv
 * minuteCaloriesNarrow_merged.csv
 * minuteCaloriesWide_merged.csv
 * minuteIntensitiesNarrow_merged.csv
 * minuteIntensitiesWide_merged.csv
 * minuteMETsNarrow_merged.csv
 * minuteSleep_merged-edit.csv
 * minuteStepsNarrow_merged.csv
 * minuteStepsWide_merged.csv
 * sleepDay_merged-edit.csv
 * weightLogInfo_merged.csv


### Data Credibility and Integrity:
Due to the limitation of size (30 users) and not having any demographic information we could encounter a sampling bias. Since the unique identifier of each dataset is the ID we can't tell whether the gender of the user in order to gain more precise insights. 
Another challenge encountered is that the dataset is not current and the survey has a small time-frame of 2 months.
In order to overcome this we will give the case study an operational approach. 

## Process Phase 

### Tool Used 
R was used to analyze the dataset due to its accessibility, amount of data and the ability to create visualizations easily in order to share results with stake holders 

#### Installation of Packages and Opening Libraries
The necessary packages used to clean, process, analyze and visualize the data to generate insights were installed and opened 

```{r Installing Packages, include=FALSE}
install.packages("tidyverse", repos = "http://cran.us.r-project.org")
install.packages("lubridate", repos = "http://cran.us.r-project.org")
install.packages("ggpubr", repos = "http://cran.us.r-project.org")

```

```{r Loading Packages, include=FALSE}
library(tidyverse)
library(lubridate)
library(dplyr)
library(skimr)
library(tidyr)
library(janitor)
library(readr)
library(tibble)
library(ggplot2)
library(ggpubr)
library(ggrepel)

```

#### Importing Datasets 
Only a handful of the datasets will be used to answer our business task.
In our analysis the following Datasets are used:

* Daily_Activity
* Daily_Sleep 

```{r Importing Datasets, include=FALSE}
Daily_activity <- read.csv("dailyActivity_merged.csv")
Daily_Sleep <- read.csv("sleepDay_merged.csv")
```

### Preview Datasets 
The selected datasets are previewed and a glimpse of each columns are viewed to identify if the data needs to be cleaned and standardized 

```{r Previewing the datasets }
head(Daily_activity)
glimpse(Daily_activity)
colnames(Daily_activity)

head(Daily_Sleep)
glimpse(Daily_Sleep)
colnames(Daily_Sleep)
```

### Cleaning and Formatting
After viewing the data structure the data is then processed to look for any errors and inconsistencies 

#### Verifying Number of Users 
To ensure the data tallies with the description of the no of users that was sampled  given we check the no of unique users. Even though 30 is the minimal sample size we will still keep the sleep dataset for practice only.

```{r}
n_unique(Daily_activity$Id)
n_unique(Daily_Sleep$Id)
```

#### Duplicates
Duplicates are identified and Removed 

```{r Removal of Duplicates and N/A}
sum(duplicated(Daily_activity)) 
sum(duplicated(Daily_Sleep))

Daily_activity <- Daily_activity %>% 
  distinct() %>% 
  drop_na()

Daily_Sleep <- Daily_Sleep %>% 
  distinct() %>% 
  drop_na()
```

after running we identify that all duplicates have been removed 

```{r}
sum(duplicated(Daily_Sleep))
```

#### Clean and rename column
We would ensure that column names are using right syntax and same format in all datasets since it will be merged later on. We are changing the fromat of all the columns to lowercase

```{r Clean names and rename columns, include=FALSE}
clean_names(Daily_activity)
Daily_activity <- rename_with(Daily_activity, tolower)

clean_names(Daily_Sleep)
Daily_Sleep <- rename_with(Daily_Sleep, tolower)
```

#### Consistency of date and time columns 
Now that all column names have been standardized next the date-time format for both daily_activity and daily_sleep will be cleaned so it can be merged.

```{r}
Daily_activity <- Daily_activity %>%
  rename(date = activitydate) %>%
  mutate(date = as_date(date, format = "%m/%d/%Y"))

Daily_Sleep <- Daily_Sleep %>%
  rename(date = sleepday) %>%
  mutate(date = as_date(date,format ="%m/%d/%Y %I:%M:%S %p" , tz=Sys.timezone()))

head(Daily_activity)

head(Daily_Sleep)

```

### Merging Datasets
The daily_activity and daily_sleep data is then merged to see any correlation between variables by using id and date as their primary key 
```{r Merging the Data }
Daily_Fitness <- merge(Daily_activity, Daily_Sleep, by = c("id", "date"))
glimpse(Daily_Fitness)
```


## Analyze Phase and Share Phase 
Here we analyze trends of users of Fitbit and determine if that can help us on BellaBeat's marketing strategy

### Distance Covered Per User 
In order to get a summary visualization on the distance covered by each user a dataframe was created from the merged data showing the totaldistance/trackerdistance  covered by each user.
The id column had to be converted to the as.character format to prevent errors upon visualization 
```{r}
Distance_covered_per_user <- Daily_activity %>% 
  mutate(id = as.character(id)) %>% 
  group_by(id) %>% 
  summarise(total_distance_covered = sum(trackerdistance)) 

ggplot(Distance_covered_per_user) +
  geom_col(aes(x=id, y = total_distance_covered , fill = total_distance_covered )) + 
  geom_hline(yintercept = 200) +
  labs(title = "Distance Covered Per User", x="User ID", y="Total Distance Covered") + 
  scale_fill_gradient(low = "red", high = "green")+
  theme(axis.text.x = element_text(angle = 90))
```

From the graph we can see that less than 10 of the 33 users covered a total distance of over 200m throughout the duration their tracker logged their distance.
This summary can give inferences into the amount of times each user wore their device and also show how active each user was. 

### Types of users per activity level 
Since no demographic variables are given from the sample we want to determine the types of users with the data we have. We can classify the users by activity considering the daily amount of steps. We can categorize users as follows:

 * Inactive = Less than 5000 steps a day
 * Lightly active = Between 5000 and 7499 steps a day
 * Fairly active = Between 7500 and 9999 steps a day
 * Very active = More than 10,000 steps a day 

The classification was made based on the following article 
<https://www.healthline.com/health/how-many-steps-a-day#Why-10,000-steps?>

First we will calculate the daily steps average by user 

```{r}
Daily_Average<- Daily_Fitness %>% 
  group_by(id) %>% 
  summarise(avg_daily_steps = mean(totalsteps), avg_daily_distance = mean(totaldistance), avg_daily_calories = mean(calories), avg_daily_sleep = mean(totalminutesasleep))

head(Daily_Average)
```

The Users would then be classified by the daily average steps 
```{r}
user_type<- Daily_Average %>% 
  mutate(user_type = case_when(
    avg_daily_steps < 5000 ~ "Inactive",
    avg_daily_steps >= 5000 & avg_daily_steps < 7499 ~ "Lightly Active",
    avg_daily_steps >= 7499 & avg_daily_steps < 9999 ~ "Fairly Active",
    avg_daily_steps > 10000 ~ "Very Active"
  ))

head(user_type)
```

Now a new column has been created with the user type we will create a data frame with the percentage of each user type to better visualize them on a graph

```{r}
activity_level_percent <- user_type %>% 
  group_by(user_type) %>% 
  summarise(total = n()) %>% 
  mutate(totals = sum(total)) %>% 
  group_by(user_type) %>% 
  summarise(percentage_dbn = total/totals) %>% 
  mutate(labels = scales::percent(percentage_dbn))

activity_level_percent$user_type <- factor(activity_level_percent$user_type , 
                                           levels = c("Very Active", "Fairly Active", "Lightly Active", "Inactive"))

head(activity_level_percent)
```

Below we can see that users are fairly distributed by their activity considering the daily amount of steps. We can determine that based on users activity all kind of users wear smart-devices.

```{r}
activity_level_dbn <- activity_level_percent %>% 
  ggplot(aes(x = "", y = percentage_dbn, fill = user_type)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  theme_minimal() +
  geom_text(aes(label = labels), position = position_stack(vjust = 0.5)) +
  labs(title = "User Activity Level Distribution")

activity_level_dbn
```

### Steps and Minutes Asleep per weekday
We find out what days of the week are the users more active and also what days of the week users sleep more. We will also verify if the users walk the recommended amount of steps and have the recommended amount of sleep.

Below we are calculating the weekdays based on our column date. We are also calculating the average steps walked and minutes slept by weekday.

```{r}
Weekly_activity <- Daily_Fitness %>% 
  mutate(Weekday = weekdays(date))

Weekly_activity$Weekday <- ordered(Weekly_activity$Weekday, levels = c
                                   ("Monday", "Tuesday", "Wednesday", "Thursday", "Friday",
                                      "Saturday", "Sunday" ))

Weekly_activity <- Weekly_activity %>% 
  group_by(Weekday) %>% 
  summarise(daily_steps = mean(totalsteps), daily_sleep = mean(totalminutesasleep))

head(Weekly_activity)
```


```{r}
Weekly_activity_dbn <- ggarrange(
  ggplot(Weekly_activity) +
    geom_col(aes(Weekday, daily_steps), fill = "#319043") +
    geom_hline(yintercept = 7500) +
    labs(title = "Daily steps per weekday", x = "", y = "No of Steps") +
    theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1)) ,
  ggplot(Weekly_activity, aes(Weekday, daily_sleep)) +
    geom_col(fill = "#456688") + 
    geom_hline(yintercept = 400) +
    labs(title = "No of Minutes Asleep per weekday", x = "", y = "Minutes Spent Sleeping") + 
    theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1))
  # note code in theme was used to make the weekdays on the x-axis stay at an angle  
)
  
Weekly_activity_dbn
```

In the graphs above we can determine the following:

  * Users walk the recommended amount of steps of 7500 on every weekday asides from Sunday's.

  * Users don't sleep the recommended amount of minutes/ hours - 8 hours
  
## Correlations 
We will now determine if there is any correlation between different variables:

 * Daily steps and daily sleep
 * Daily steps and calories
 
```{r}
Trend <- ggarrange(
  ggplot(Daily_Fitness, aes(x=totalsteps, y=totalminutesasleep)) +
    geom_jitter() +
    geom_smooth(color = "orange") + 
    labs(title = "Daily steps vs Minutes asleep", x = "Daily steps", y= "Minutes asleep"),
  ggplot(Daily_Fitness, aes(x=totalsteps, y=calories)) +
    geom_jitter() +
    geom_smooth(color = "orange") + 
    labs(title = "Daily steps vs Calories", x = "Daily steps", y= "Calories") 
   
) 

Trend
```

Per our plots:

 * There is no correlation between daily activity level based on steps and the amount of minutes users sleep a day.

 * Otherwise we can see a positive correlation between steps and calories burned. As assumed the more steps walked the more calories may be burned.
 
### Use of Smart Devices 

#### Days used smart device 
Now that we have seen some trends in activity, sleep and calories burned, we want to see how often do the users in our sample use their device. That way we can plan our marketing strategy and see what features would benefit the use of smart devices.

We will calculate the number of users that use their smart device on a daily basis, classifying our sample into three categories knowing that the date interval is 31 days:

 * high use - users who use their device between 21 and 31 days.
 * moderate use - users who use their device between 10 and 20 days.
 * low use - users who use their device between 1 and 10 days.
First we will create a new data frame grouping by Id, calculating number of days used and creating a new column with the classification explained above.

```{r}
Daily_Device_Use <- Daily_Fitness %>% 
  group_by(id) %>% 
  summarise(days_used = sum(n())) %>% 
  mutate(usage = case_when(
    days_used >= 1 & days_used <= 10 ~ "Low Use",
    days_used > 10 & days_used <= 20 ~ "Moderately Used",
    days_used > 20 & days_used <= 31 ~ "Frequently Used"
  )) 

head(Daily_Device_Use)  
```

We will now create a percentage data frame to better visualize the results in the graph. We are also ordering our usage levels.

```{r}
Daily_Device_Use_percent <- Daily_Device_Use %>% 
  group_by(usage) %>% 
  summarise(total = n()) %>% 
  mutate(totals = sum(total)) %>% 
  group_by(usage) %>% 
  summarise(total_percent = total/totals) %>% 
  mutate(labels = scales::percent(total_percent))  

Daily_Device_Use_percent$usage <- factor(Daily_Device_Use_percent$usage
                                         , levels = c("Frequently Used", "Moderately Used", "Low Use")) 


head(Daily_Device_Use_percent) 
```

Now that we have our new table we can create our plot:

```{r}
Daily_Device_Use_dbn <- Daily_Device_Use_percent %>% 
  ggplot(aes(x = "", y = total_percent, fill = usage)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  theme_minimal()+
  geom_text(aes(label = labels), position = position_stack(vjust = 0.5)) +
  labs(title = "Daily Smart Device Use")

Daily_Device_Use_dbn

```

Analyzing our results we can see that

 * 50% of the users of our sample use their device frequently - between
  21 to 31 days.
 * 12% use their device 11 to 20 days.
 * 38% of our sample use really rarely their device.
 
#### Time used smart device 
Being more precise we want to see how many minutes do users wear their device per day. For that we will merge the created daily_use data frame and daily_activity to be able to filter results by daily use of device as well.

```{r}
daily_use_merged  <- merge(Daily_activity, Daily_Device_Use, by = c("id") ) 

head(daily_use_merged)
```

We need to create a new data frame calculating the total amount of minutes users wore the device every day and creating three different categories:

 * All day - device was worn all day.
 * More than half day - device was worn more than half of the day.
 * Less than half day - device was worn less than half of the day.
 
```{r}
Period_Device_Worn <- daily_use_merged %>% 
  mutate(total_minutes_worn = veryactiveminutes + fairlyactiveminutes +
           lightlyactiveminutes + sedentaryminutes) %>% 
  mutate(percent_minutes_worn = (total_minutes_worn/1440)*100) %>% 
  mutate(worn = case_when(
    percent_minutes_worn == 100 ~ "Whole day",
    percent_minutes_worn < 100 & percent_minutes_worn >=50 ~ "More than half day", 
    percent_minutes_worn < 50 & percent_minutes_worn > 0 ~ "Less than half day"
  ))

head(Period_Device_Worn)
```

As we have done before, to better visualize our results we will create new data frames. In this case we will create four different data frames to arrange them later on on a same visualization.

 * First data frame will show the total of users and will calculate percentage of minutes worn the device taking into consideration the three categories created.

 * The three other data frames are filtered by category of daily users so that we can see also the difference of daily use and time use.

```{r}
Period_Device_Worn_percent <- Period_Device_Worn %>% 
  group_by(worn) %>% 
  summarise(total = n()) %>% 
  mutate(totals = sum(total)) %>% 
  group_by(worn) %>% 
  summarise(total_percent = total/totals) %>% 
  mutate(labels = scales::percent(total_percent))

period_worn_high <- Period_Device_Worn %>% 
  filter(usage == "Frequently Used") %>% 
  group_by(worn) %>% 
  summarise(total = n()) %>% 
  mutate(totals = sum(total)) %>% 
  group_by(worn) %>% 
  summarise(total_percent = total/totals) %>% 
  mutate(labels = scales::percent(total_percent)) 

period_worn_moderate <- Period_Device_Worn %>% 
  filter(usage == "Moderately Used") %>% 
  group_by(worn) %>% 
  summarise(total = n()) %>% 
  mutate(totals = sum(total)) %>% 
  group_by(worn) %>% 
  summarise(total_percent = total/totals) %>% 
  mutate(labels = scales::percent(total_percent)) 

period_worn_low <- Period_Device_Worn %>% 
  filter(usage == "Low Use") %>% 
  group_by(worn) %>% 
  summarise(total = n()) %>% 
  mutate(totals = sum(total)) %>% 
  group_by(worn) %>% 
  summarise(total_percent = total/totals) %>% 
  mutate(labels = scales::percent(total_percent)) 

period_worn_high$worn <- factor(period_worn_high$worn, 
                                levels = c("Whole day", "More than half day", "Less than half day"))

period_worn_moderate$worn <- factor(period_worn_moderate$worn, 
                                levels = c("Whole day", "More than half day", "Less than half day")) 

period_worn_low$worn <- factor(period_worn_low$worn, 
                                levels = c("Whole day", "More than half day", "Less than half day")) 

Period_Device_Worn_percent$worn <- factor(Period_Device_Worn_percent$worn, 
                                levels = c("Whole day", "More than half day", "Less than half day")) 


head(period_worn_high)
head(period_worn_low)
head(period_worn_moderate)
head(Period_Device_Worn_percent)
```

Now that we have created the four data frames and also ordered worn level categories, we can visualize our results in the following plots. All the plots have been arranged together for a better visualization.

```{r}
Usage_Period_Dbn <- ggarrange(
  ggplot(Period_Device_Worn_percent, aes(x="",y=total_percent, fill=worn)) +
    geom_bar(stat = "identity", width = 1)+
    coord_polar("y", start=0)+
    theme_minimal()+
    theme(axis.title.x= element_blank(),
          axis.title.y = element_blank(),
          panel.border = element_blank(), 
          panel.grid = element_blank(), 
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          plot.title = element_text(hjust = 0.5, size=14, face = "bold"),
          plot.subtitle = element_text(hjust = 0.5)) +
    scale_fill_manual(values = c("#004587", "#367676", "#ddefdf"))+
    geom_text(aes(label = labels),
              position = position_stack(vjust = 0.5), size = 3.5)+
    labs(title="Period worn per day", subtitle = "Total Users"),
  ggarrange(
    ggplot(period_worn_high, aes(x="",y=total_percent, fill=worn)) +
      geom_bar(stat = "identity", width = 1)+
      coord_polar("y", start=0)+
      theme_minimal()+
      theme(axis.title.x= element_blank(),
            axis.title.y = element_blank(),
            panel.border = element_blank(), 
            panel.grid = element_blank(), 
            axis.ticks = element_blank(),
            axis.text.x = element_blank(),
            plot.title = element_text(hjust = 0.5, size=14, face = "bold"),
            plot.subtitle = element_text(hjust = 0.5), 
            legend.position = "none")+
      scale_fill_manual(values = c("#004587", "#367676", "#ddefdf"))+
      geom_text_repel(aes(label = labels),
                      position = position_stack(vjust = 0.5), size = 3)+
      labs(title="", subtitle = "High use - Users"), 
    ggplot(period_worn_moderate, aes(x="",y=total_percent, fill=worn)) +
      geom_bar(stat = "identity", width = 1)+
      coord_polar("y", start=0)+
      theme_minimal()+
      theme(axis.title.x= element_blank(),
            axis.title.y = element_blank(),
            panel.border = element_blank(), 
            panel.grid = element_blank(), 
            axis.ticks = element_blank(),
            axis.text.x = element_blank(),
            plot.title = element_text(hjust = 0.5, size=14, face = "bold"), 
            plot.subtitle = element_text(hjust = 0.5),
            legend.position = "none") +
      scale_fill_manual(values = c("#004587", "#367676", "#ddefdf"))+
      geom_text(aes(label = labels),
                position = position_stack(vjust = 0.5), size = 3)+
      labs(title="", subtitle = "Moderate use - Users"), 
    ggplot(period_worn_low, aes(x="",y=total_percent, fill=worn)) +
      geom_bar(stat = "identity", width = 1)+
      coord_polar("y", start=0)+
      theme_minimal()+
      theme(axis.title.x= element_blank(),
            axis.title.y = element_blank(),
            panel.border = element_blank(), 
            panel.grid = element_blank(), 
            axis.ticks = element_blank(),
            axis.text.x = element_blank(),
            plot.title = element_text(hjust = 0.5, size=14, face = "bold"), 
            plot.subtitle = element_text(hjust = 0.5),
            legend.position = "none") +
      scale_fill_manual(values = c("#004587", "#367676", "#ddefdf"))+
      geom_text(aes(label = labels),
                position = position_stack(vjust = 0.5), size = 3)+
      labs(title="", subtitle = "Low use - Users"), 
    ncol = 3), 
  nrow = 2)

Usage_Period_Dbn
```

Per our plots we can see that 36% of the total of users wear the device all day long, 60% more than half day long and just 4% less than half day.

If we filter the total users considering the days they have used the device and also check each day how long they have worn the device, we have the following results:

Reminder:

  * high use - users who use their device between 21 and 31 days.
  * moderate use - users who use their device between 10 and 20 days.
  * low use - users who use their device between 1 and 10 days.
  
High users - Just 6.8% of the users that have used their device between 21 and 31 days wear it all day. 88.9% wear the device more than half day but not all day.

Moderate users are the ones who wear the device less on a daily basis.

Being low users who wear more time their device the day they use it.

## Conclusion (Act Phase)

Bellabeat's mission is to empower women by providing them with the data to discover themselves.

In order for us to respond to our business task and help Bellabeat on their mission, based on our results, I would advice to use own tracking data for further analysis. Datasets used have a small sample and can be biased since we didn't have any demographic details of users. Knowing that our main target are young and adult women I would encourage to continue finding trends to be able to create a marketing strategy focused on them.

That being said, after our analysis we have found different trends that may help our online campaign and improve Bellabeat app:

1.  Daily notification on steps taken for the user wearing any Bellabeat fitness tracking device and posts on app - This can be done by sending users alarms if they have not completed their daily recommended steps or any fitness goals they have set for themselves 

2.  Reward system as incentive to ensure the users remain active and stay healthy - A way of inducing incentives would be to gamify the process and give badges for each milestone reached with the amount of badges accumulated being redeemable to receive free merchandise or a discount on other Bellabeat products  

On our analysis we didn't just check trends on daily users habits we also realized that just 50% of the users use their device on a daily basis and that just 36% of the users wear the device all time the day they used it. We can continue promote Bellabeat's products features:

  * Water-resistant
  * Long-lasting batteries
  * Fashion/ elegant products
You can wear the products everyday to any occasion without worrying about the battery.